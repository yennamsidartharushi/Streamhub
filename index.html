  
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Streamhub - Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --accent: #ff0000; --bg: #000000; }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg);
            color: white;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
            width: 100%;
        }

        /* Fluid Typography */
        .hero-title { font-size: clamp(2.5rem, 8vw, 6rem); line-height: 0.9; }
        
        /* Smooth Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }

        /* Modern Glassmorphism */
        .glass {
            background: rgba(10, 10, 10, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* Movie Card Aspect Ratio */
        .card-aspect { aspect-ratio: 2/3; }

        /* Professional Transitions */
        .view-transition { animation: slideUp 0.5s cubic-bezier(0.2, 1, 0.3, 1) forwards; }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Video Container */
        .player-wrapper { position: relative; width: 100%; padding-top: 56.25%; background: black; }
        .player-wrapper iframe {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;
        }

        /* Admin & Form Styles */
        .input-dark {
            background: #18181b;
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            padding: 0.75rem;
            border-radius: 0.5rem;
            width: 100%;
            outline: none;
            transition: 0.3s;
        }
        .input-dark:focus { border-color: #ff0000; }

        /* Chat Styles */
        .chat-box {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: #09090b;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            z-index: 150;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: translateY(110%);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .chat-box.open { transform: translateY(0); }
        .chat-msg { font-size: 13px; margin-bottom: 8px; }
        .chat-msg.me { text-align: right; }
        .chat-bubble { display: inline-block; padding: 8px 12px; border-radius: 12px; max-width: 80%; }
        .chat-bubble.me { background: #dc2626; color: white; border-bottom-right-radius: 2px; }
        .chat-bubble.other { background: #27272a; color: #e4e4e7; border-bottom-left-radius: 2px; }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 200;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
    </style>
</head>
<body class="selection:bg-red-600">

    <div id="loginModal" class="modal-overlay active" style="z-index: 300;">
        <div class="bg-zinc-900 border border-white/10 p-8 rounded-3xl w-full max-w-md text-center shadow-2xl mx-4">
            <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg shadow-red-600/30">
                <i data-lucide="user" class="w-8 h-8 text-white"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2">Welcome to Streamhub</h2>
            <p class="text-zinc-500 mb-6 text-sm">Create a unique username to start watching and chatting.</p>
            <input type="text" id="usernameInput" class="input-dark text-center font-bold mb-2" placeholder="Enter Username">
            <p id="loginError" class="text-red-500 text-xs h-4 mb-4 font-bold"></p>
            <button onclick="handleLogin()" class="w-full bg-red-600 hover:bg-red-700 py-3 rounded-xl font-bold transition-colors shadow-lg">ENTER APP</button>
        </div>
    </div>

    <nav id="navbar" class="fixed top-0 w-full z-[100] transition-all duration-300 px-4 md:px-10 h-16 md:h-20 flex items-center justify-between">
        <div onclick="navigate('home')" class="flex items-center gap-2 cursor-pointer">
            <div class="bg-red-600 p-1.5 rounded-lg shadow-lg shadow-red-600/30">
                <i data-lucide="clapperboard" class="w-5 h-5 text-white"></i>
            </div>
            <span class="text-xl font-extrabold tracking-tighter uppercase italic">Streamhub</span>
        </div>

        <div class="flex-1 max-w-md mx-4 hidden sm:flex items-center bg-white/5 border border-white/10 rounded-full px-4 py-1.5 focus-within:bg-white/10 transition-all">
            <i data-lucide="search" class="w-4 h-4 text-zinc-500"></i>
            <input type="text" id="navSearchInput" onkeypress="if(event.key === 'Enter') navigate('search', this.value)" placeholder="Search movies, series..." class="bg-transparent border-none focus:ring-0 w-full ml-2 text-sm text-white focus:outline-none">
        </div>

        <div class="flex items-center gap-4">
             <button onclick="navigate('library')" class="p-2 text-zinc-400 hover:text-white transition-colors" title="Library">
                <i data-lucide="grid" class="w-6 h-6"></i>
            </button>
            
            <button onclick="navigate('search')" class="p-2 text-zinc-400 hover:text-white transition-colors sm:hidden" title="Search">
                <i data-lucide="search" class="w-6 h-6"></i>
            </button>

            <button onclick="navigate('mylist')" class="p-2 text-zinc-400 hover:text-white transition-colors relative" title="My List">
                <i data-lucide="bookmark" class="w-6 h-6"></i>
                <span id="listCounter" class="absolute -top-1 -right-1 bg-red-600 text-[10px] w-4 h-4 rounded-full flex items-center justify-center text-white hidden">0</span>
            </button>

            <button onclick="toggleChat()" class="p-2 text-zinc-400 hover:text-red-500 transition-colors relative" title="Chat">
                <i data-lucide="message-circle" class="w-6 h-6"></i>
            </button>

            <button onclick="navigate('admin-login')" class="w-9 h-9 rounded-full bg-zinc-800 border border-white/10 flex items-center justify-center font-bold text-xs hover:bg-red-600 transition-colors">
                ADM
            </button>
        </div>
    </nav>

    <div id="chatBox" class="chat-box flex flex-col">
        <div class="p-4 border-b border-white/10 flex justify-between items-center bg-zinc-900 rounded-t-2xl">
            <div class="flex items-center gap-2">
                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                <h3 class="font-bold text-sm">Community Chat</h3>
            </div>
            <button onclick="toggleChat()" class="text-zinc-500 hover:text-white"><i data-lucide="x" class="w-4 h-4"></i></button>
        </div>
        <div id="chatMessages" class="flex-1 overflow-y-auto p-4 custom-scrollbar bg-black/50">
            </div>
        <div class="p-3 border-t border-white/10 bg-zinc-900 rounded-b-2xl flex gap-2">
            <input type="text" id="chatInput" onkeypress="if(event.key === 'Enter') sendChatMessage()" placeholder="Suggest a movie..." class="flex-1 bg-zinc-800 border-none rounded-lg text-xs px-3 py-2 text-white focus:outline-none">
            <button onclick="sendChatMessage()" class="bg-red-600 p-2 rounded-lg hover:bg-red-700 transition-colors">
                <i data-lucide="send" class="w-4 h-4 text-white"></i>
            </button>
        </div>
    </div>

    <div id="main-content" class="min-h-screen"></div>

    <script>
        // --- DATA & STATE MANAGEMENT ---
        // Added 'trailer' field for YouTube links
        const DEFAULT_MOVIES = [
            { id: "1", type: "movie", category: "Cartoon", title: "Nobita's Earth Symphony", desc: "Doraemon and friends go on an adventure to meet new buddies, connect to people with music, and save the world from a crisis.", year: "2024", genre: "Sci-Fi", rating: "4.8", poster: "Nobita's Earth Symphony.jpg", backdrop: "https://drive.google.com/uc?export=view&id=11vnOboVDsUEdQ74FlOBMCcFBtKA6KMbp", video: "https://drive.google.com/file/d/1aEOXPRx41neIKpL6rE9nSGOcdfd8MDts/preview", trailer: "https://youtu.be/hwN3QpGGEe0?si=Yrpw--3cpxO_h0fW", download: "https://drive.google.com/uc?id=1aEOXPRx41neIKpL6rE9nSGOcdfd8MDts&export=download" },
            { id: "2", type: "movie", category: "Cartoon", title: "Shinchan: The Dark Hero", desc: "Shin Chan gets his mother to finally buy him the last Ultra Hero sword, but when he opens the package there is only one rule inside. Chaos ensues.", year: "2024", genre: "Comedy", rating: "4.9", poster: "sinchannew2.jpg", backdrop: "https://image.tmdb.org/t/p/original/xOMo8BRK7PfcJv9JCnx7s5hj0PX.jpg", video: "https://drive.google.com/file/d/1UdlK5XumO5kjJ66eVIyuPjw4H6883i8p/preview", trailer: "https://www.youtube.com/watch?v=f2O5s_0qA4Q", download: "https://drive.google.com/uc?id=1UdlK5XumO5kjJ66eVIyuPjw4H6883i8p&export=download" },
            { id: "3", type: "movie", category: "Cartoon", title: "Nobita & Island of Miracles", desc: "Nobita and Doraemon use the time tree Mochi to catch a big bird Moa. They travel to Beremon Island to protect extinct animals.", year: "2023", genre: "Adventure", rating: "4.8", poster: "[AnimeSalt] Doraemon - Movie 32 - Nobita and the Island of Miracles—Animal Adventure (2012) [1080p] [Multi-Audio].jpg", backdrop: "https://image.tmdb.org/t/p/original/nGks949fAnSOfN86o99pS90m6vM.jpg", video: "https://drive.google.com/file/d/1VZZNAucJrd0AozUB-eKzp4Wbp7PZ2giW/preview", trailer: "https://www.youtube.com/watch?v=1VZZNAucJrd0AozUB", download: "https://drive.google.com/uc?id=1VZZNAucJrd0AozUB-eKzp4Wbp7PZ2giW&export=download" },
            { id: "4", type: "movie", category: "Cartoon", title: "Nobita no Takarajima", desc: "Upon hearing about the story of Treasure Island, Nobita dreams of discovering and exploring his own treasure island.", year: "2023", genre: "Fantasy", rating: "4.7", poster: "nobitanotakarajima.jpg", backdrop: "https://image.tmdb.org/t/p/original/fm6KqXpk3M2HVveHwCrBSSBaO0V.jpg", video: "https://drive.google.com/file/d/1xRKBDCrEWi_h3Mxskl4S74xPjakxYTC8/preview", trailer: "https://www.youtube.com/watch?v=1xRKBDCrEWi_h3Mxskl4S74xPjakxYTC8", download: "https://drive.google.com/uc?id=1xRKBDCrEWi_h3Mxskl4S74xPjakxYTC8&export=download" },
            { id: "5", type: "movie", category: "Movies", title: "HouseMates", desc: "Newly married Karthik and Anu buys an old apartment and starts their life, soon they start witnessing strange things happening in the house and and they think it is an act of ghost, but soon they find the shocking truth.", year: "2023", genre: "Biography", rating: "8.4", poster: "HouseMates.jpg", backdrop: "HouseMates.jpg", video: "https://drive.google.com/file/d/1GgpMlcd7s_B7tcfIiMASsSFobd3jDIWw/preview", trailer: "https://www.youtube.com/watch?v=1GgpMlcd7s_B7tcfIiMASsSFobd3jDIWw", download: "#" },
            { id: "6", type: "movie", category: "Movies", title: "Bakasuraristorent", desc: "A wish of 5 youngsters leads them to unveil a supernatural force lurking beneath around them", year: "2024", genre: "Sci-Fi", rating: "8.8", poster: "bakasuraristorent1.jpg", backdrop: "bakasuraristorent1.jpg ", video: "https://drive.google.com/file/d/1ULN377YQ_cOvfhssPrUJ102nL0zwNkD-/preview", trailer: "https://www.youtube.com/watch?v=1ULN377YQ_cOvfhssPrUJ102nL0zwNkD-", download: "#" },
            { id: "7", type: "series", category: "Series", title: "Stranger Things", desc: "When a young boy vanishes, a small town uncovers a mystery involving secret experiments, terrifying supernatural forces, and one strange little girl.", year: "2022", genre: "Horror", rating: "8.7", poster: "https://i.pinimg.com/736x/9e/16/71/9e1671a9dcd52a73533542860b70bc79.jpg", backdrop: "https://i.pinimg.com/736x/9e/16/71/9e1671a9dcd52a73533542860b70bc79.jpg", 
              seasons: {
                  "Season 1": [
                      { title: "Chapter One: The Vanishing", link: "https://drive.google.com/file/d/1VZZNAucJrd0AozUB-eKzp4Wbp7PZ2giW/preview" },
                      { title: "Chapter Two: The Weirdo", link: "https://drive.google.com/file/d/1GgpMlcd7s_B7tcfIiMASsSFobd3jDIWw/preview" }
                  ],
                  "Season 2": [
                       { title: "Chapter One: MADMAX", link: "https://drive.google.com/file/d/1xRKBDCrEWi_h3Mxskl4S74xPjakxYTC8/preview" }
                  ]
              },
              video: "", trailer: "https://www.youtube.com/watch?v=b9EkMc79ZSU", download: "#" 
            },
            { id: "8", type: "movie", category: "Movies", title: "Pushpa 2: The Rule", desc: "A smuggling kingpin faces off against a vengeful rival while manipulating politics, making big deals, and navigating tense confrontations.", year: "2024", genre: "Crime", rating: "9.5", poster: "https://i.pinimg.com/736x/fa/c5/e4/fac5e4b9a664ae363c1b87c5e2e79bba.jpg", backdrop: "https://i.pinimg.com/736x/fa/c5/e4/fac5e4b9a664ae363c1b87c5e2e79bba.jpg", video: "https://drive.google.com/file/d/1KMpDIUADHhRtgoSwM2S3M2GlZqjsF2N1/preview", trailer: "https://www.youtube.com/watch?v=1KMpDIUADHhRtgoSwM2S3M2GlZqjsF2N1", download: "#" },
            { id: "9", type: "movie", category: "Movies", title: "IT", desc: "In the summer of 1989, a group of bullied kids band together to destroy a shape-shifting monster, which disguises itself as a clown and preys on the children of Derry.", year: "2017", genre: "Horror", rating: "7.3", poster: "https://i.pinimg.com/1200x/b7/98/6f/b7986fd15b8305fee4ecacdd035eb972.jpg", backdrop: "https://i.pinimg.com/1200x/b7/98/6f/b7986fd15b8305fee4ecacdd035eb972.jpg", video: "https://drive.google.com/file/d/1wcayQvEctgF11OMQmQz1XzjWhVkmJEXM/preview", trailer: "https://www.youtube.com/watch?v=xKJmEC5ieOk", download: "#" },
            { id: "10", type: "movie", category: "Movies", title: "Iron Man 3", desc: "When Tony Stark's world is torn apart by a formidable terrorist called the Mandarin, he starts an odyssey of rebuilding and retribution.", year: "2013", genre: "Action", rating: "7.1", poster: "https://i.pinimg.com/1200x/6d/15/0c/6d150c6e17f6c7f33362e34fab1c10c7.jpg", backdrop: "https://i.pinimg.com/1200x/6d/15/0c/6d150c6e17f6c7f33362e34fab1c10c7.jpg", video: "https://drive.google.com/file/d/1oTlzFUwZrzlPKHwGcIeMOjZvXLaqy7h1/preview", trailer: "https://www.youtube.com/watch?v=Ke1Y3P9D0Bc", download: "#" },
            { id: "11", type: "movie", category: "Movies", title: "Ayalaan", desc: "An alien lands on Earth and befriends a group of humans, but they must protect him from a scientist seeking to exploit him.", year: "2024", genre: "Action", rating: "5.9", poster: "ayalaan1.jpg", backdrop: "https://im.jdmagicbox.com/comp/jd_social/news/2024jan13/image-1251988-l6jmu24mxj.jpg?clr=#293d3d", video: "https://drive.google.com/file/d/1GgpMlcd7s_B7tcfIiMASsSFobd3jDIWw/preview", trailer: "https://www.youtube.com/watch?v=1GgpMlcd7s_B7tcfIiMASsSFobd3jDIWw", download: "#" }
        ];

        // Global State
        let dbMovies = [];
        let watchlist = JSON.parse(localStorage.getItem('sv_list') || '[]');
        let registeredUsers = JSON.parse(localStorage.getItem('sv_users') || '[]');
        let chatHistory = JSON.parse(localStorage.getItem('sv_chat_msgs') || '[]');
        let currentUser = localStorage.getItem('sv_current_user');
        let activeFilter = 'All';
        let adminEditId = null;

        // Initialize DB
        function initDB() {
            const saved = localStorage.getItem('sv_movies_v3'); // Updated version
            if (saved) {
                dbMovies = JSON.parse(saved);
            } else {
                dbMovies = DEFAULT_MOVIES;
                saveDB();
            }
        }
        function saveDB() {
            localStorage.setItem('sv_movies_v3', JSON.stringify(dbMovies));
        }
        initDB();

        // --- LOGIN LOGIC ---
        function checkSession() {
            if (currentUser) {
                document.getElementById('loginModal').classList.remove('active');
            }
        }

        function handleLogin() {
            const input = document.getElementById('usernameInput');
            const error = document.getElementById('loginError');
            const username = input.value.trim();

            if (username.length < 3) {
                error.innerText = "Username must be at least 3 characters.";
                return;
            }

            // Check if username exists (simulating global uniqueness)
            if (registeredUsers.includes(username.toLowerCase())) {
                 // In a real app, you'd check password. Here, we enforce uniqueness for new users
                 // For demo: if exists, assume it's this user logging back in (simplification) or show error
                 // Per prompt: "username which is not have same to another user" -> Enforce uniqueness
                 // Since we can't auth, let's just say "Taken" unless it's stored in this browser
                 
                 // Simpler approach for local demo:
                 error.innerText = "Username taken. Try another.";
            } else {
                registeredUsers.push(username.toLowerCase());
                localStorage.setItem('sv_users', JSON.stringify(registeredUsers));
                currentUser = username;
                localStorage.setItem('sv_current_user', username);
                document.getElementById('loginModal').classList.remove('active');
                addSystemMessage(`${username} joined Streamhub!`);
            }
        }

        // --- ENGINE ---
        function navigate(view, param = null, extra = null) {
            const container = document.getElementById('main-content');
            window.scrollTo(0, 0);

            if (view === 'home') renderHome();
            else if (view === 'details') renderDetails(param);
            else if (view === 'player') renderPlayer(param, extra); 
            else if (view === 'trailer') renderTrailerPlayer(param); // New Trailer View
            else if (view === 'mylist') renderMyList();
            else if (view === 'library') renderLibrary();
            else if (view === 'search') renderSearch(param);
            else if (view === 'admin-login') renderAdminLogin();
            else if (view === 'admin-panel') renderAdminPanel();
            
            lucide.createIcons();
            updateListBadge();
        }

        // --- YOUTUBE HELPER ---
        function getYoutubeId(url) {
            if(!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        // --- CHAT LOGIC ---
        function toggleChat() {
            document.getElementById('chatBox').classList.toggle('open');
            renderChatMessages();
            // Scroll to bottom
            const container = document.getElementById('chatMessages');
            setTimeout(() => container.scrollTop = container.scrollHeight, 100);
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (!text || !currentUser) return;

            const msg = {
                user: currentUser,
                text: text,
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
            };

            chatHistory.push(msg);
            // Limit history to 50 messages
            if (chatHistory.length > 50) chatHistory.shift();
            
            localStorage.setItem('sv_chat_msgs', JSON.stringify(chatHistory));
            input.value = '';
            renderChatMessages();
        }

        function addSystemMessage(text) {
             const msg = { user: 'System', text: text, time: new Date().toLocaleTimeString() };
             chatHistory.push(msg);
             localStorage.setItem('sv_chat_msgs', JSON.stringify(chatHistory));
        }

        function renderChatMessages() {
            const container = document.getElementById('chatMessages');
            container.innerHTML = chatHistory.map(msg => {
                const isMe = msg.user === currentUser;
                const isSystem = msg.user === 'System';
                
                if (isSystem) {
                    return `<div class="text-center text-[10px] text-zinc-500 my-2 italic">${msg.text}</div>`;
                }

                return `
                    <div class="chat-msg ${isMe ? 'me' : ''}">
                        <div class="text-[10px] text-zinc-400 mb-1 px-1">${msg.user}</div>
                        <div class="chat-bubble ${isMe ? 'me' : 'other'}">
                            ${msg.text}
                        </div>
                    </div>
                `;
            }).join('');
            container.scrollTop = container.scrollHeight;
        }

        // --- HOME VIEW ---
        function renderHome() {
            const hero = dbMovies.find(m => m.id === "11") || dbMovies[0];
            const filtered = activeFilter === 'All' ? dbMovies : dbMovies.filter(m => m.category === activeFilter);
            
            document.getElementById('main-content').innerHTML = `
                <div class="view-transition">
                    <header class="relative h-[70vh] md:h-[85vh] flex flex-col justify-end px-4 md:px-10 pb-16 overflow-hidden">
                        <img src="${hero.backdrop}" class="absolute inset-0 w-full h-full object-cover scale-105 opacity-60">
                        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/20 to-transparent"></div>
                        <div class="relative z-10 max-w-4xl space-y-4">
                            <span class="bg-red-600 text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-widest">Trending Now</span>
                            <h1 class="hero-title font-extrabold tracking-tighter uppercase italic">${hero.title}</h1>
                            <div class="flex items-center gap-3 text-sm text-zinc-300">
                                <span>${hero.year}</span>
                                <span class="w-1 h-1 bg-zinc-500 rounded-full"></span>
                                <span>${hero.category}</span>
                                <span class="w-1 h-1 bg-zinc-500 rounded-full"></span>
                                <span>${hero.rating} ★</span>
                            </div>
                            <p class="text-zinc-300 text-sm md:text-lg max-w-xl line-clamp-2 md:line-clamp-3">${hero.desc}</p>
                            <div class="flex gap-3 pt-4">
                                <button onclick="navigate('details', '${hero.id}')" class="bg-white text-black px-6 md:px-10 py-3 rounded-xl font-bold text-sm md:text-base flex items-center gap-2 hover:bg-red-600 hover:text-white transition-all">
                                    <i data-lucide="play" class="w-5 h-5 fill-current"></i> WATCH
                                </button>
                                ${hero.trailer ? `
                                <button onclick="navigate('trailer', '${hero.id}')" class="bg-white/10 backdrop-blur-md px-6 md:px-10 py-3 rounded-xl font-bold text-sm md:text-base border border-white/10 hover:bg-white/20 transition-all flex items-center gap-2">
                                    <i data-lucide="youtube" class="w-5 h-5"></i> TRAILER
                                </button>` : ''}
                            </div>
                        </div>
                    </header>

                    <div class="px-4 md:px-10 pb-20 -mt-10 relative z-20">
                        <div class="flex gap-3 overflow-x-auto no-scrollbar pb-6">
                            ${['All', 'Movies', 'Cartoon', 'Series'].map(cat => `
                                <button onclick="setFilter('${cat}')" class="shrink-0 px-6 py-2 rounded-full text-xs font-bold transition-all border border-transparent ${activeFilter === cat ? 'bg-red-600 text-white shadow-lg shadow-red-900/50' : 'bg-zinc-900 border-white/10 text-zinc-400 hover:text-white hover:border-white/30'}">
                                    ${cat}
                                </button>
                            `).join('')}
                        </div>
                        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4 md:gap-8">
                            ${filtered.map(m => createCard(m)).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        // --- DETAILS VIEW ---
        function renderDetails(id) {
            const movie = dbMovies.find(m => m.id === id);
            const inList = watchlist.some(m => m.id === id);
            const isSeries = movie.type === 'series' && movie.seasons;
            
            let seriesHtml = '';
            if (isSeries) {
                const seasonNames = Object.keys(movie.seasons);
                const firstSeason = seasonNames[0]; 
                
                seriesHtml = `
                    <div class="mt-8 bg-zinc-900/50 border border-white/5 rounded-2xl p-6">
                        <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                            <i data-lucide="layers" class="w-5 h-5 text-red-600"></i> Episodes
                        </h3>
                        <div class="mb-6 flex gap-2 overflow-x-auto no-scrollbar" id="seasonTabs">
                            ${seasonNames.map((s, idx) => `
                                <button onclick="switchSeason('${id}', '${s}')" class="px-4 py-2 rounded-lg text-sm font-bold border border-white/10 transition-colors ${idx===0 ? 'bg-white text-black' : 'bg-black text-zinc-400 hover:text-white'}">
                                    ${s}
                                </button>
                            `).join('')}
                        </div>
                        <div id="episodeList" class="space-y-2 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar">
                            ${generateEpisodeList(movie, firstSeason)}
                        </div>
                    </div>
                `;
            }

            document.getElementById('main-content').innerHTML = `
                <div class="view-transition pt-24 pb-12 px-4 md:px-10">
                    <div class="max-w-6xl mx-auto flex flex-col md:flex-row gap-8 lg:gap-16">
                        <div class="w-full md:w-[350px] lg:w-[400px] shrink-0">
                            <div class="relative rounded-3xl overflow-hidden shadow-2xl border border-white/5 aspect-[2/3]">
                                <img src="${movie.poster}" class="w-full h-full object-cover">
                            </div>
                        </div>
                        <div class="flex-1 space-y-6 md:py-8">
                            <button onclick="navigate('home')" class="text-zinc-500 hover:text-white flex items-center gap-2 text-[10px] font-bold tracking-[0.2em]">
                                <i data-lucide="chevron-left" class="w-4 h-4"></i> BACK
                            </button>
                            <h1 class="hero-title font-extrabold tracking-tighter uppercase italic leading-none">${movie.title}</h1>
                            <div class="flex flex-wrap gap-3 text-xs font-bold text-zinc-400 items-center">
                                <span class="bg-red-600 text-white px-2 py-0.5 rounded">${movie.rating} IMDB</span>
                                <span>${movie.year}</span>
                                <span class="w-1 h-1 bg-zinc-600 rounded-full"></span>
                                <span class="text-zinc-200">${movie.category}</span>
                                <span class="w-1 h-1 bg-zinc-600 rounded-full"></span>
                                <span class="px-2 border border-white/10 rounded uppercase">${movie.genre}</span>
                            </div>
                            <p class="text-base md:text-xl text-zinc-300 leading-relaxed max-w-2xl">${movie.desc}</p>
                            
                            <div class="flex flex-col gap-3 pt-6">
                                <div class="flex flex-col sm:flex-row gap-3">
                                    ${!isSeries ? `
                                        <button onclick="navigate('player', '${movie.id}')" class="bg-red-600 hover:bg-red-700 transition-colors px-8 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 shadow-lg shadow-red-900/20 w-full sm:w-auto">
                                            <i data-lucide="play" class="w-5 h-5 fill-current"></i> WATCH MOVIE
                                        </button>
                                    ` : `
                                        <button class="bg-zinc-800 cursor-default px-8 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 w-full sm:w-auto border border-white/10">
                                            <i data-lucide="monitor-play" class="w-5 h-5"></i> SELECT EPISODE
                                        </button>
                                    `}
                                    
                                    ${movie.trailer ? `
                                        <button onclick="navigate('trailer', '${movie.id}')" class="bg-zinc-800 hover:bg-white hover:text-black border border-white/10 px-8 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 transition-colors w-full sm:w-auto">
                                            <i data-lucide="youtube" class="w-5 h-5"></i> TRAILER
                                        </button>
                                    ` : ''}

                                    <button onclick="toggleList('${movie.id}')" class="bg-zinc-800 hover:bg-zinc-700 border border-white/10 px-6 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 transition-colors w-full sm:w-auto">
                                        <i data-lucide="${inList ? 'check' : 'plus'}" class="w-5 h-5 ${inList ? 'text-red-500' : ''}"></i>
                                    </button>
                                </div>
                                
                                <a href="${movie.download}" target="_blank" class="group bg-zinc-900 hover:bg-zinc-800 border border-zinc-800 px-8 py-4 rounded-xl font-bold text-zinc-400 hover:text-white flex items-center justify-center gap-3 transition-all w-full sm:w-auto sm:max-w-[200px]">
                                    <i data-lucide="download" class="w-5 h-5 group-hover:scale-110 transition-transform"></i> Download
                                </a>
                            </div>

                            ${seriesHtml}

                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        function renderPlayer(id, videoUrl = null) {
            const movie = dbMovies.find(m => m.id === id);
            const src = videoUrl || movie.video;
            
            document.getElementById('main-content').innerHTML = `
                <div class="fixed inset-0 z-[200] bg-black flex items-center justify-center view-transition">
                    <button onclick="navigate('details', '${movie.id}')" class="absolute top-6 left-6 z-20 p-3 bg-white/10 hover:bg-white/20 backdrop-blur rounded-full text-white transition-all">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                    <div class="w-full max-w-7xl mx-auto px-0 md:px-4">
                        <div class="player-wrapper shadow-2xl md:rounded-xl overflow-hidden">
                            <iframe src="${src}" allow="autoplay; fullscreen" allowfullscreen></iframe>
                        </div>
                        <div class="p-4 text-center md:text-left">
                            <h2 class="text-xl font-bold uppercase italic tracking-tight">${movie.title}</h2>
                            <p class="text-zinc-500 text-sm">Now Playing • Main Stream</p>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        // --- TRAILER PLAYER ---
        function renderTrailerPlayer(id) {
            const movie = dbMovies.find(m => m.id === id);
            const ytId = getYoutubeId(movie.trailer);
            const src = `https://www.youtube.com/embed/${ytId}?autoplay=1&rel=0`;

            document.getElementById('main-content').innerHTML = `
                <div class="fixed inset-0 z-[200] bg-black flex items-center justify-center view-transition">
                    <button onclick="navigate('details', '${movie.id}')" class="absolute top-6 left-6 z-20 p-3 bg-white/10 hover:bg-white/20 backdrop-blur rounded-full text-white transition-all">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                    <div class="w-full max-w-7xl mx-auto px-0 md:px-4">
                        <div class="player-wrapper shadow-2xl md:rounded-xl overflow-hidden">
                            <iframe src="${src}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                        </div>
                        <div class="p-4 text-center md:text-left">
                            <h2 class="text-xl font-bold uppercase italic tracking-tight text-red-500">Official Trailer</h2>
                            <p class="text-zinc-300 text-lg">${movie.title}</p>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        // --- SEARCH, LIBRARY, ADMIN (Standard) ---
        function renderSearch(query = '') {
            document.getElementById('main-content').innerHTML = `
                <div class="view-transition pt-24 px-4 md:px-10 pb-20">
                    <h1 class="text-3xl font-extrabold uppercase italic tracking-tighter mb-8">Search & Explore</h1>
                    <div class="flex flex-col md:flex-row gap-4 mb-10">
                        <div class="flex-1 bg-zinc-900 border border-white/10 rounded-xl px-4 py-3 flex items-center gap-3">
                            <i data-lucide="search" class="w-5 h-5 text-zinc-400"></i>
                            <input type="text" id="pageSearchInput" value="${query}" oninput="performSearch()" placeholder="Search title..." class="bg-transparent border-none w-full text-white focus:outline-none placeholder-zinc-500">
                        </div>
                        <select id="genreFilter" onchange="performSearch()" class="bg-zinc-900 border border-white/10 rounded-xl px-4 py-3 text-zinc-300 focus:outline-none"><option value="All">All Genres</option><option value="Action">Action</option><option value="Sci-Fi">Sci-Fi</option><option value="Horror">Horror</option><option value="Comedy">Comedy</option><option value="Adventure">Adventure</option></select>
                        <select id="catFilter" onchange="performSearch()" class="bg-zinc-900 border border-white/10 rounded-xl px-4 py-3 text-zinc-300 focus:outline-none"><option value="All">All Categories</option><option value="Movies">Movies</option><option value="Cartoon">Cartoon</option><option value="Series">Series</option></select>
                    </div>
                    <div id="searchResults" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4 md:gap-8"></div>
                </div>
            `;
            performSearch();
            lucide.createIcons();
        }

        function performSearch() {
            const q = document.getElementById('pageSearchInput').value.toLowerCase();
            const g = document.getElementById('genreFilter').value;
            const c = document.getElementById('catFilter').value;
            const results = dbMovies.filter(m => {
                const matchText = m.title.toLowerCase().includes(q);
                const matchGenre = g === 'All' || m.genre.includes(g);
                const matchCat = c === 'All' || m.category === c;
                return matchText && matchGenre && matchCat;
            });
            document.getElementById('searchResults').innerHTML = results.length > 0 ? results.map(m => createCard(m)).join('') : `<div class="col-span-full py-20 text-center text-zinc-600 font-bold uppercase tracking-widest">No Matches Found</div>`;
            lucide.createIcons();
        }

        function renderLibrary() {
            const genres = [...new Set(dbMovies.map(m => m.genre))];
            let html = `<div class="view-transition pt-24 px-4 md:px-10 pb-20"><h1 class="text-4xl md:text-6xl font-extrabold uppercase italic tracking-tighter mb-10">Library <span class="text-red-600">Vault</span></h1>`;
            genres.forEach(g => {
                const sectionMovies = dbMovies.filter(m => m.genre === g);
                html += `<div class="mb-12"><div class="flex items-center gap-3 mb-4 border-b border-white/10 pb-2"><div class="w-2 h-6 bg-red-600 rounded-sm"></div><h2 class="text-xl font-bold uppercase tracking-wide">${g}</h2><span class="text-xs text-zinc-500 font-mono ml-auto">${sectionMovies.length} Items</span></div><div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-6 gap-4">${sectionMovies.map(m => createCard(m)).join('')}</div></div>`;
            });
            html += `</div>`;
            document.getElementById('main-content').innerHTML = html;
        }

        function renderMyList() {
            document.getElementById('main-content').innerHTML = `<div class="view-transition pt-24 px-4 md:px-10 pb-20"><h1 class="text-4xl md:text-6xl font-extrabold uppercase italic tracking-tighter mb-10">My <span class="text-red-600">Watchlist</span></h1>${watchlist.length === 0 ? `<div class="py-20 text-center text-zinc-600 font-bold uppercase tracking-widest flex flex-col items-center gap-4"><i data-lucide="folder-open" class="w-12 h-12 opacity-50"></i>Your vault is empty</div>` : `<div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4 md:gap-8">${watchlist.map(m => createCard(m)).join('')}</div>`}</div>`;
        }

        // --- ADMIN ---
        function renderAdminLogin() {
            document.getElementById('main-content').innerHTML = `<div class="min-h-screen flex items-center justify-center bg-black view-transition px-4"><div class="w-full max-w-md bg-zinc-900 border border-white/10 p-8 rounded-3xl text-center"><div class="w-16 h-16 bg-red-600/20 text-red-500 rounded-full flex items-center justify-center mx-auto mb-6"><i data-lucide="lock" class="w-8 h-8"></i></div><h2 class="text-2xl font-bold mb-2">Admin Access</h2><input type="password" id="adminPin" class="input-dark text-center text-2xl tracking-[0.5em] font-bold mb-6" maxlength="4" placeholder="••••"><button onclick="checkAdmin()" class="w-full bg-red-600 hover:bg-red-700 py-3 rounded-xl font-bold transition-colors">UNLOCK PANEL</button><button onclick="navigate('home')" class="w-full mt-3 text-zinc-500 text-xs hover:text-white">RETURN HOME</button></div></div>`;
        }
        function checkAdmin() { if(document.getElementById('adminPin').value === '1234') navigate('admin-panel'); else alert('Access Denied'); }

        function renderAdminPanel() {
            const total = dbMovies.length;
            const seriesCount = dbMovies.filter(m => m.type === 'series').length;
            
            document.getElementById('main-content').innerHTML = `
                <div class="view-transition pt-24 px-4 md:px-10 pb-20 max-w-7xl mx-auto">
                    <div class="flex justify-between items-end mb-8">
                        <div><h1 class="text-3xl font-extrabold uppercase italic tracking-tighter">Admin <span class="text-red-600">Dashboard</span></h1></div>
                        <button onclick="navigate('home')" class="text-xs font-bold border border-white/10 px-4 py-2 rounded hover:bg-white/5">EXIT</button>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10">
                        <div class="bg-zinc-900 border border-white/10 p-4 rounded-xl"><div class="text-zinc-500 text-xs uppercase font-bold">Total</div><div class="text-2xl font-bold text-white">${total}</div></div>
                        <div class="bg-zinc-900 border border-white/10 p-4 rounded-xl"><div class="text-zinc-500 text-xs uppercase font-bold">Series</div><div class="text-2xl font-bold text-red-500">${seriesCount}</div></div>
                    </div>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="md:col-span-1">
                            <div class="bg-zinc-900 border border-white/10 p-6 rounded-2xl sticky top-24">
                                <h3 class="font-bold text-lg mb-4 flex items-center gap-2"><i data-lucide="plus-circle" class="w-5 h-5 text-red-600"></i> <span id="formTitle">Add Content</span></h3>
                                <form onsubmit="handleMovieSubmit(event)" class="space-y-3">
                                    <input type="hidden" id="editId">
                                    <select id="mType" onchange="toggleFormType()" class="input-dark bg-black font-bold text-red-500"><option value="movie">Movie</option><option value="series">Series / Anime</option></select>
                                    <input required id="mTitle" placeholder="Title" class="input-dark">
                                    <textarea required id="mDesc" placeholder="Description" class="input-dark h-24 text-sm"></textarea>
                                    <div class="grid grid-cols-2 gap-2"><input required id="mYear" placeholder="Year" class="input-dark"><input required id="mRating" placeholder="Rating" class="input-dark"></div>
                                    <div class="grid grid-cols-2 gap-2"><input required id="mGenre" placeholder="Genre" class="input-dark"><select id="mCat" class="input-dark"><option value="Movies">Movies</option><option value="Cartoon">Cartoon</option><option value="Series">Series</option></select></div>
                                    <input required id="mPoster" placeholder="Poster URL" class="input-dark text-xs">
                                    <input required id="mBackdrop" placeholder="Backdrop URL" class="input-dark text-xs">
                                    <input id="mTrailer" placeholder="YouTube Trailer Link" class="input-dark text-xs text-red-400 border-red-900/30">
                                    <div id="movieInputs"><input id="mVideo" placeholder="Movie Stream URL" class="input-dark text-xs"></div>
                                    <div id="seriesInputs" class="hidden"><p class="text-[10px] text-zinc-500 mb-1">Enter Episodes: Season | Name | URL</p><textarea id="mSeasonsData" placeholder="Season 1 | Ep 1 Name | Link..." class="input-dark h-32 text-xs font-mono"></textarea></div>
                                    <input id="mDown" placeholder="Download Link" class="input-dark text-xs">
                                    <div class="flex gap-2 pt-2"><button type="submit" class="flex-1 bg-red-600 hover:bg-red-700 py-2 rounded-lg font-bold text-sm">SAVE</button><button type="button" onclick="resetForm()" class="px-4 bg-zinc-800 rounded-lg hover:bg-zinc-700">Cancel</button></div>
                                </form>
                            </div>
                        </div>
                        <div class="md:col-span-2"><div class="bg-zinc-900 border border-white/10 rounded-2xl overflow-hidden"><table class="w-full text-left text-sm text-zinc-400"><thead class="bg-black/30 text-xs uppercase font-bold text-zinc-500"><tr><th class="p-4">Title</th><th class="p-4 hidden sm:table-cell">Type</th><th class="p-4 text-right">Actions</th></tr></thead><tbody class="divide-y divide-white/5">${dbMovies.map(m => `<tr class="hover:bg-white/5 transition-colors"><td class="p-4 flex items-center gap-3"><img src="${m.poster}" class="w-8 h-12 object-cover rounded bg-zinc-800"><div><div class="font-bold text-white">${m.title}</div><div class="text-[10px]">${m.year}</div></div></td><td class="p-4 hidden sm:table-cell"><span class="bg-zinc-800 px-2 py-1 rounded text-[10px] uppercase border ${m.type === 'series' ? 'border-red-500/50 text-red-400' : 'border-white/10'}">${m.type || 'movie'}</span></td><td class="p-4 text-right"><button onclick="editMovie('${m.id}')" class="text-blue-400 hover:text-white mr-2"><i data-lucide="edit-2" class="w-4 h-4"></i></button><button onclick="deleteMovie('${m.id}')" class="text-red-500 hover:text-white"><i data-lucide="trash" class="w-4 h-4"></i></button></td></tr>`).join('')}</tbody></table></div></div>
                    </div>
                </div>
            `;
            toggleFormType();
            lucide.createIcons();
        }

        function toggleFormType() {
            const type = document.getElementById('mType').value;
            if (type === 'series') { document.getElementById('movieInputs').classList.add('hidden'); document.getElementById('seriesInputs').classList.remove('hidden'); } 
            else { document.getElementById('movieInputs').classList.remove('hidden'); document.getElementById('seriesInputs').classList.add('hidden'); }
        }

        function handleMovieSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('editId').value || Date.now().toString();
            const type = document.getElementById('mType').value;
            let seasonsData = null;
            if (type === 'series') seasonsData = parseSeriesData(document.getElementById('mSeasonsData').value);

            const newMovie = {
                id: id, type: type,
                title: document.getElementById('mTitle').value,
                desc: document.getElementById('mDesc').value,
                year: document.getElementById('mYear').value,
                rating: document.getElementById('mRating').value,
                genre: document.getElementById('mGenre').value,
                category: document.getElementById('mCat').value,
                poster: document.getElementById('mPoster').value,
                backdrop: document.getElementById('mBackdrop').value,
                trailer: document.getElementById('mTrailer').value,
                video: type === 'movie' ? document.getElementById('mVideo').value : '',
                seasons: seasonsData,
                download: document.getElementById('mDown').value || '#'
            };

            if (adminEditId) { dbMovies[dbMovies.findIndex(m => m.id === adminEditId)] = newMovie; adminEditId = null; } 
            else { dbMovies.unshift(newMovie); }
            saveDB(); renderAdminPanel(); resetForm();
        }

        function parseSeriesData(text) {
            const lines = text.split('\n'); const seasons = {};
            lines.forEach(line => {
                if (!line.trim()) return;
                const parts = line.split('|');
                if (parts.length >= 3) {
                    const sName = parts[0].trim(); const epTitle = parts[1].trim(); const epLink = parts[2].trim();
                    if (!seasons[sName]) seasons[sName] = [];
                    seasons[sName].push({ title: epTitle, link: epLink });
                }
            });
            return seasons;
        }

        function stringifySeriesData(seasonsObj) {
            if (!seasonsObj) return ''; let text = '';
            for (const [sName, eps] of Object.entries(seasonsObj)) {
                eps.forEach(ep => { text += `${sName} | ${ep.title} | ${ep.link}\n`; });
            }
            return text;
        }

        function deleteMovie(id) { if(confirm('Delete?')) { dbMovies = dbMovies.filter(m => m.id !== id); saveDB(); renderAdminPanel(); } }

        function editMovie(id) {
            const m = dbMovies.find(x => x.id === id); adminEditId = id;
            document.getElementById('formTitle').innerText = 'Edit Content';
            document.getElementById('editId').value = m.id; document.getElementById('mType').value = m.type || 'movie';
            document.getElementById('mTitle').value = m.title; document.getElementById('mDesc').value = m.desc;
            document.getElementById('mYear').value = m.year; document.getElementById('mRating').value = m.rating;
            document.getElementById('mGenre').value = m.genre; document.getElementById('mCat').value = m.category;
            document.getElementById('mPoster').value = m.poster; document.getElementById('mBackdrop').value = m.backdrop;
            document.getElementById('mTrailer').value = m.trailer || ''; document.getElementById('mVideo').value = m.video;
            document.getElementById('mDown').value = m.download;
            if (m.type === 'series') document.getElementById('mSeasonsData').value = stringifySeriesData(m.seasons);
            toggleFormType(); window.scrollTo(0,0);
        }

        function resetForm() {
            document.querySelector('form').reset(); adminEditId = null; document.getElementById('editId').value = '';
            document.getElementById('formTitle').innerText = 'Add Content'; document.getElementById('mType').value = 'movie'; toggleFormType();
        }

        // --- COMMON COMPONENTS ---
        function createCard(m) {
            return `<div onclick="navigate('details', '${m.id}')" class="group cursor-pointer"><div class="card-aspect rounded-2xl md:rounded-[2rem] overflow-hidden border border-white/5 bg-zinc-900 relative transition-transform duration-500 group-hover:scale-[1.03] group-hover:border-red-600/50"><img src="${m.poster}" class="w-full h-full object-cover" loading="lazy" onerror="this.src='https://via.placeholder.com/300x450?text=No+Poster'"><div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"><div class="bg-red-600 p-3 rounded-full shadow-xl shadow-red-600/40 transform scale-0 group-hover:scale-100 transition-transform duration-300"><i data-lucide="play" class="w-5 h-5 fill-current text-white"></i></div></div>${m.type === 'series' ? `<div class="absolute top-2 left-2 bg-red-600 text-white px-2 py-1 rounded-lg text-[10px] font-bold uppercase shadow-lg">SERIES</div>` : ''}<div class="absolute top-2 right-2 bg-black/60 backdrop-blur-md px-2 py-1 rounded-lg text-[10px] font-bold uppercase border border-white/10">${m.category}</div></div><div class="mt-3 px-1"><h4 class="font-bold text-xs md:text-sm uppercase tracking-tight truncate">${m.title}</h4><div class="flex justify-between items-center mt-1"><span class="text-[10px] text-zinc-500 font-bold tracking-widest uppercase">${m.genre} • ${m.year}</span><span class="text-[10px] text-red-500 font-black flex items-center gap-1"><i data-lucide="star" class="w-2 h-2 fill-current"></i> ${m.rating}</span></div></div></div>`;
        }

        function generateEpisodeList(movie, seasonKey) {
            const episodes = movie.seasons[seasonKey] || [];
            if(episodes.length === 0) return '<div class="text-zinc-500 italic">No episodes found.</div>';
            return episodes.map((ep, index) => `<div onclick="navigate('player', '${movie.id}', '${ep.link}')" class="group flex items-center gap-4 p-3 rounded-xl hover:bg-white/10 cursor-pointer border border-transparent hover:border-white/5 transition-all"><div class="text-zinc-500 font-bold text-lg w-6">${index + 1}</div><div class="w-10 h-10 rounded-full bg-zinc-800 flex items-center justify-center group-hover:bg-red-600 transition-colors"><i data-lucide="play" class="w-4 h-4 fill-current text-white"></i></div><div class="flex-1"><h4 class="font-bold text-sm text-zinc-200 group-hover:text-white">${ep.title}</h4></div></div>`).join('');
        }

        function switchSeason(movieId, seasonKey) {
            const movie = dbMovies.find(m => m.id === movieId);
            const listContainer = document.getElementById('episodeList');
            const tabsContainer = document.getElementById('seasonTabs');
            listContainer.innerHTML = generateEpisodeList(movie, seasonKey);
            Array.from(tabsContainer.children).forEach(btn => {
                if(btn.innerText.trim() === seasonKey) btn.className = "px-4 py-2 rounded-lg text-sm font-bold border border-white/10 transition-colors bg-white text-black";
                else btn.className = "px-4 py-2 rounded-lg text-sm font-bold border border-white/10 transition-colors bg-black text-zinc-400 hover:text-white";
            });
            lucide.createIcons();
        }

        function setFilter(cat) { activeFilter = cat; renderHome(); lucide.createIcons(); }
        
        function toggleList(id) {
            const movie = dbMovies.find(m => m.id === id); const index = watchlist.findIndex(m => m.id === id);
            if (index > -1) watchlist.splice(index, 1); else watchlist.push(movie);
            localStorage.setItem('sv_list', JSON.stringify(watchlist));
            renderDetails(id); updateListBadge();
        }

        function updateListBadge() {
            const badge = document.getElementById('listCounter');
            if (watchlist.length > 0) { badge.innerText = watchlist.length; badge.classList.remove('hidden'); } 
            else { badge.classList.add('hidden'); }
        }

        window.onscroll = () => {
            const nav = document.getElementById('navbar');
            if (window.scrollY > 20) nav.classList.add('glass'); else nav.classList.remove('glass');
        };

        window.onload = () => {
            checkSession();
            navigate('home');
        };
    </script>
</body>
</html>

 

